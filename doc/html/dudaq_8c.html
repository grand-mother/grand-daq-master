<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>grand DAQ: /Users/timmer/Library/Mobile Documents/com~apple~CloudDocs/CloudWork/GRAND/grand-daq-master/dudaq/files/dudaq.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">grand DAQ
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5c2f82581d2af5bcba4bb1150bd82478.html">dudaq</a></li><li class="navelem"><a class="el" href="dir_6a5f1d7c6f6638b1a0a7b5ba8d549b73.html">files</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">dudaq.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>steering file for the Detector Unit software  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;sys/wait.h&gt;</code><br />
<code>#include &lt;sys/time.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;sys/ioctl.h&gt;</code><br />
<code>#include &lt;sys/select.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;netinet/tcp.h&gt;</code><br />
<code>#include &lt;netinet/in.h&gt;</code><br />
<code>#include &lt;net/if.h&gt;</code><br />
<code>#include &lt;arpa/inet.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &quot;dudaq.h&quot;</code><br />
<code>#include &quot;<a class="el" href="amsg_8h_source.html">amsg.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="scope_8h_source.html">scope.h</a>&quot;</code><br />
<code>#include &quot;ad_shm.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a504a79f76696628453f674e03d14fab9" id="r_a504a79f76696628453f674e03d14fab9"><td class="memItemLeft" align="right" valign="top"><a id="a504a79f76696628453f674e03d14fab9" name="a504a79f76696628453f674e03d14fab9"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>send_t3_event</b> (int t3_id, int index, int evttype)</td></tr>
<tr class="separator:a504a79f76696628453f674e03d14fab9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbbf7d60d96a749b6e9b320582d5de10" id="r_acbbf7d60d96a749b6e9b320582d5de10"><td class="memItemLeft" align="right" valign="top"><a id="acbbf7d60d96a749b6e9b320582d5de10" name="acbbf7d60d96a749b6e9b320582d5de10"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>remove_shared_memory</b> ()</td></tr>
<tr class="separator:acbbf7d60d96a749b6e9b320582d5de10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e7526227a6d67734cfd602e2614111e" id="r_a0e7526227a6d67734cfd602e2614111e"><td class="memItemLeft" align="right" valign="top"><a id="a0e7526227a6d67734cfd602e2614111e" name="a0e7526227a6d67734cfd602e2614111e"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>clean_stop</b> (int signum)</td></tr>
<tr class="separator:a0e7526227a6d67734cfd602e2614111e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92f7b5d93622a416d05dcc46c41e7ab2" id="r_a92f7b5d93622a416d05dcc46c41e7ab2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dudaq_8c.html#a92f7b5d93622a416d05dcc46c41e7ab2">block_signals</a> (int iblock)</td></tr>
<tr class="memdesc:a92f7b5d93622a416d05dcc46c41e7ab2"><td class="mdescLeft">&#160;</td><td class="mdescRight">block sigio/sigpipe  <br /></td></tr>
<tr class="separator:a92f7b5d93622a416d05dcc46c41e7ab2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a3c3390c14ffc01395c0a184d834315" id="r_a0a3c3390c14ffc01395c0a184d834315"><td class="memItemLeft" align="right" valign="top"><a id="a0a3c3390c14ffc01395c0a184d834315" name="a0a3c3390c14ffc01395c0a184d834315"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>set_socketoptions</b> (int sock)</td></tr>
<tr class="separator:a0a3c3390c14ffc01395c0a184d834315"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7193a4bd1cc84e09349989dfec2cb1d" id="r_ae7193a4bd1cc84e09349989dfec2cb1d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dudaq_8c.html#ae7193a4bd1cc84e09349989dfec2cb1d">make_server_connection</a> (int port)</td></tr>
<tr class="memdesc:ae7193a4bd1cc84e09349989dfec2cb1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">connect to central DAQ  <br /></td></tr>
<tr class="separator:ae7193a4bd1cc84e09349989dfec2cb1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57d32a2cbac1da983a55bfb03a05c0fe" id="r_a57d32a2cbac1da983a55bfb03a05c0fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dudaq_8c.html#a57d32a2cbac1da983a55bfb03a05c0fe">check_server_data</a> ()</td></tr>
<tr class="memdesc:a57d32a2cbac1da983a55bfb03a05c0fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">check and execute commands from central DAQ  <br /></td></tr>
<tr class="separator:a57d32a2cbac1da983a55bfb03a05c0fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6f7aeeb3effe54c0d30bb7ae34438ce" id="r_ac6f7aeeb3effe54c0d30bb7ae34438ce"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dudaq_8c.html#ac6f7aeeb3effe54c0d30bb7ae34438ce">socket_send</a> (char *bf, int length)</td></tr>
<tr class="memdesc:ac6f7aeeb3effe54c0d30bb7ae34438ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">send buffer to the central DAQ  <br /></td></tr>
<tr class="separator:ac6f7aeeb3effe54c0d30bb7ae34438ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a48765e628107301e3981a9370d2d56" id="r_a9a48765e628107301e3981a9370d2d56"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dudaq_8c.html#a9a48765e628107301e3981a9370d2d56">send_server_data</a> ()</td></tr>
<tr class="memdesc:a9a48765e628107301e3981a9370d2d56"><td class="mdescLeft">&#160;</td><td class="mdescRight">send t2 data to the central DAQ  <br /></td></tr>
<tr class="separator:a9a48765e628107301e3981a9370d2d56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40d5f8a6e595461f4a0a9c27ff598c0f" id="r_a40d5f8a6e595461f4a0a9c27ff598c0f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dudaq_8c.html#a40d5f8a6e595461f4a0a9c27ff598c0f">du_scope_check_commands</a> ()</td></tr>
<tr class="memdesc:a40d5f8a6e595461f4a0a9c27ff598c0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">interpreting DAQ commands for fpga  <br /></td></tr>
<tr class="separator:a40d5f8a6e595461f4a0a9c27ff598c0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8c0fdf47a45bfe19bbe33854fda9952" id="r_ab8c0fdf47a45bfe19bbe33854fda9952"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dudaq_8c.html#ab8c0fdf47a45bfe19bbe33854fda9952">du_scope_main</a> ()</td></tr>
<tr class="memdesc:ab8c0fdf47a45bfe19bbe33854fda9952"><td class="mdescLeft">&#160;</td><td class="mdescRight">main fpga handling routine  <br /></td></tr>
<tr class="separator:ab8c0fdf47a45bfe19bbe33854fda9952"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6307a963abd17f30664038b8f4499603" id="r_a6307a963abd17f30664038b8f4499603"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dudaq_8c.html#a6307a963abd17f30664038b8f4499603">du_get_station_id</a> ()</td></tr>
<tr class="separator:a6307a963abd17f30664038b8f4499603"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1fe02d124aabfd2ab6e4d54679248d8" id="r_ad1fe02d124aabfd2ab6e4d54679248d8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dudaq_8c.html#ad1fe02d124aabfd2ab6e4d54679248d8">du_socket_main</a> ()</td></tr>
<tr class="memdesc:ad1fe02d124aabfd2ab6e4d54679248d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles all communication with the IP socket.  <br /></td></tr>
<tr class="separator:ad1fe02d124aabfd2ab6e4d54679248d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627" id="r_a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top"><a id="a3c04138a5bfe5d72780bb7e82a18e627" name="a3c04138a5bfe5d72780bb7e82a18e627"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>main</b> (int argc, char **argv)</td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0b3ad6f4f8f4b807b90fcd5de25b485b" id="r_a0b3ad6f4f8f4b807b90fcd5de25b485b"><td class="memItemLeft" align="right" valign="top"><a id="a0b3ad6f4f8f4b807b90fcd5de25b485b" name="a0b3ad6f4f8f4b807b90fcd5de25b485b"></a>
<a class="el" href="structshm__struct.html">shm_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><b>shm_ev</b></td></tr>
<tr class="memdesc:a0b3ad6f4f8f4b807b90fcd5de25b485b"><td class="mdescLeft">&#160;</td><td class="mdescRight">shared memory containing event indices, including read/write pointers <br /></td></tr>
<tr class="separator:a0b3ad6f4f8f4b807b90fcd5de25b485b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a243df20e2497f32e6fe4835b594b2d52" id="r_a243df20e2497f32e6fe4835b594b2d52"><td class="memItemLeft" align="right" valign="top"><a id="a243df20e2497f32e6fe4835b594b2d52" name="a243df20e2497f32e6fe4835b594b2d52"></a>
<a class="el" href="structshm__struct.html">shm_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><b>shm_gps</b></td></tr>
<tr class="memdesc:a243df20e2497f32e6fe4835b594b2d52"><td class="mdescLeft">&#160;</td><td class="mdescRight">shared memory containing all GPS indices, including read/write pointers <br /></td></tr>
<tr class="separator:a243df20e2497f32e6fe4835b594b2d52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26023941824774235ebc6f96a61d3acb" id="r_a26023941824774235ebc6f96a61d3acb"><td class="memItemLeft" align="right" valign="top"><a id="a26023941824774235ebc6f96a61d3acb" name="a26023941824774235ebc6f96a61d3acb"></a>
<a class="el" href="structshm__struct.html">shm_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><b>shm_cmd</b></td></tr>
<tr class="memdesc:a26023941824774235ebc6f96a61d3acb"><td class="mdescLeft">&#160;</td><td class="mdescRight">shared memory containing all command info, including read/write pointers <br /></td></tr>
<tr class="separator:a26023941824774235ebc6f96a61d3acb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad65a8842cc674e3ddf69355898c0ecbf" id="r_ad65a8842cc674e3ddf69355898c0ecbf"><td class="memItemLeft" align="right" valign="top"><a id="ad65a8842cc674e3ddf69355898c0ecbf" name="ad65a8842cc674e3ddf69355898c0ecbf"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>errno</b></td></tr>
<tr class="memdesc:ad65a8842cc674e3ddf69355898c0ecbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">the number of the error encountered <br /></td></tr>
<tr class="separator:ad65a8842cc674e3ddf69355898c0ecbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2302974ab647009c23d6be475739bb1" id="r_ab2302974ab647009c23d6be475739bb1"><td class="memItemLeft" align="right" valign="top"><a id="ab2302974ab647009c23d6be475739bb1" name="ab2302974ab647009c23d6be475739bb1"></a>
uint32_t *&#160;</td><td class="memItemRight" valign="bottom"><b>vadd_psddr</b></td></tr>
<tr class="separator:ab2302974ab647009c23d6be475739bb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc05058c4b63e61c4608a24d95743e37" id="r_afc05058c4b63e61c4608a24d95743e37"><td class="memItemLeft" align="right" valign="top"><a id="afc05058c4b63e61c4608a24d95743e37" name="afc05058c4b63e61c4608a24d95743e37"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>du_port</b></td></tr>
<tr class="memdesc:afc05058c4b63e61c4608a24d95743e37"><td class="mdescLeft">&#160;</td><td class="mdescRight">port number on which to connect to the central daq <br /></td></tr>
<tr class="separator:afc05058c4b63e61c4608a24d95743e37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecd587c4be6cba0dd6af4ea0b4d9c183" id="r_aecd587c4be6cba0dd6af4ea0b4d9c183"><td class="memItemLeft" align="right" valign="top"><a id="aecd587c4be6cba0dd6af4ea0b4d9c183" name="aecd587c4be6cba0dd6af4ea0b4d9c183"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>run</b> =0</td></tr>
<tr class="memdesc:aecd587c4be6cba0dd6af4ea0b4d9c183"><td class="mdescLeft">&#160;</td><td class="mdescRight">are you running! <br /></td></tr>
<tr class="separator:aecd587c4be6cba0dd6af4ea0b4d9c183"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a967e91bd9e44a1bf4c1f7d2623b8b9d1" id="r_a967e91bd9e44a1bf4c1f7d2623b8b9d1"><td class="memItemLeft" align="right" valign="top"><a id="a967e91bd9e44a1bf4c1f7d2623b8b9d1" name="a967e91bd9e44a1bf4c1f7d2623b8b9d1"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>station_id</b> = -1</td></tr>
<tr class="memdesc:a967e91bd9e44a1bf4c1f7d2623b8b9d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">id of the LS, obtained from the ip address <br /></td></tr>
<tr class="separator:a967e91bd9e44a1bf4c1f7d2623b8b9d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa23e0fa4e6c6b45b6c64aea8b1a5dad4" id="r_aa23e0fa4e6c6b45b6c64aea8b1a5dad4"><td class="memItemLeft" align="right" valign="top"><a id="aa23e0fa4e6c6b45b6c64aea8b1a5dad4" name="aa23e0fa4e6c6b45b6c64aea8b1a5dad4"></a>
fd_set&#160;</td><td class="memItemRight" valign="bottom"><b>sockset</b></td></tr>
<tr class="memdesc:aa23e0fa4e6c6b45b6c64aea8b1a5dad4"><td class="mdescLeft">&#160;</td><td class="mdescRight">socket series to be manipulated <br /></td></tr>
<tr class="separator:aa23e0fa4e6c6b45b6c64aea8b1a5dad4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0d3e64b196e15ece9fc54160209c352" id="r_ac0d3e64b196e15ece9fc54160209c352"><td class="memItemLeft" align="right" valign="top"><a id="ac0d3e64b196e15ece9fc54160209c352" name="ac0d3e64b196e15ece9fc54160209c352"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>DU_output</b> [MAX_OUT_MSG]</td></tr>
<tr class="memdesc:ac0d3e64b196e15ece9fc54160209c352"><td class="mdescLeft">&#160;</td><td class="mdescRight">memory used to store the data to be sent to the central DAQ <br /></td></tr>
<tr class="separator:ac0d3e64b196e15ece9fc54160209c352"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27a01304d8c306b0423826344c496f4b" id="r_a27a01304d8c306b0423826344c496f4b"><td class="memItemLeft" align="right" valign="top"><a id="a27a01304d8c306b0423826344c496f4b" name="a27a01304d8c306b0423826344c496f4b"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>DU_input</b> [MAX_INP_MSG]</td></tr>
<tr class="memdesc:a27a01304d8c306b0423826344c496f4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">memory in which to receive the socket data from the central DAQ <br /></td></tr>
<tr class="separator:a27a01304d8c306b0423826344c496f4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1e7296cb3b2abad555c1b9fc68010c6" id="r_ad1e7296cb3b2abad555c1b9fc68010c6"><td class="memItemLeft" align="right" valign="top"><a id="ad1e7296cb3b2abad555c1b9fc68010c6" name="ad1e7296cb3b2abad555c1b9fc68010c6"></a>
int32_t&#160;</td><td class="memItemRight" valign="bottom"><b>DU_socket</b> = -1</td></tr>
<tr class="memdesc:ad1e7296cb3b2abad555c1b9fc68010c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">main socket for accepting connections <br /></td></tr>
<tr class="separator:ad1e7296cb3b2abad555c1b9fc68010c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f3f77d7976d5d47d5ab3cca6c04086a" id="r_a2f3f77d7976d5d47d5ab3cca6c04086a"><td class="memItemLeft" align="right" valign="top"><a id="a2f3f77d7976d5d47d5ab3cca6c04086a" name="a2f3f77d7976d5d47d5ab3cca6c04086a"></a>
struct sockaddr_in&#160;</td><td class="memItemRight" valign="bottom"><b>DU_address</b></td></tr>
<tr class="memdesc:a2f3f77d7976d5d47d5ab3cca6c04086a"><td class="mdescLeft">&#160;</td><td class="mdescRight">structure containing address information of socket <br /></td></tr>
<tr class="separator:a2f3f77d7976d5d47d5ab3cca6c04086a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5eab1608c22b9a22a8557d390c0907d9" id="r_a5eab1608c22b9a22a8557d390c0907d9"><td class="memItemLeft" align="right" valign="top"><a id="a5eab1608c22b9a22a8557d390c0907d9" name="a5eab1608c22b9a22a8557d390c0907d9"></a>
socklen_t&#160;</td><td class="memItemRight" valign="bottom"><b>DU_alength</b></td></tr>
<tr class="memdesc:a5eab1608c22b9a22a8557d390c0907d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">length of sending socket address <br /></td></tr>
<tr class="separator:a5eab1608c22b9a22a8557d390c0907d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c1eb113d0cc50f518095c640f80e43a" id="r_a1c1eb113d0cc50f518095c640f80e43a"><td class="memItemLeft" align="right" valign="top"><a id="a1c1eb113d0cc50f518095c640f80e43a" name="a1c1eb113d0cc50f518095c640f80e43a"></a>
socklen_t&#160;</td><td class="memItemRight" valign="bottom"><b>RD_alength</b></td></tr>
<tr class="memdesc:a1c1eb113d0cc50f518095c640f80e43a"><td class="mdescLeft">&#160;</td><td class="mdescRight">length of receiving socket address <br /></td></tr>
<tr class="separator:a1c1eb113d0cc50f518095c640f80e43a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97fe47589963a834a29c7f037b922edd" id="r_a97fe47589963a834a29c7f037b922edd"><td class="memItemLeft" align="right" valign="top"><a id="a97fe47589963a834a29c7f037b922edd" name="a97fe47589963a834a29c7f037b922edd"></a>
int32_t&#160;</td><td class="memItemRight" valign="bottom"><b>DU_comms</b> = -1</td></tr>
<tr class="memdesc:a97fe47589963a834a29c7f037b922edd"><td class="mdescLeft">&#160;</td><td class="mdescRight">socket for the accepted connection <br /></td></tr>
<tr class="separator:a97fe47589963a834a29c7f037b922edd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51124cf597f93f6f589e38f49464beb4" id="r_a51124cf597f93f6f589e38f49464beb4"><td class="memItemLeft" align="right" valign="top"><a id="a51124cf597f93f6f589e38f49464beb4" name="a51124cf597f93f6f589e38f49464beb4"></a>
unsigned int&#160;</td><td class="memItemRight" valign="bottom"><b>prev_mask</b></td></tr>
<tr class="memdesc:a51124cf597f93f6f589e38f49464beb4"><td class="mdescLeft">&#160;</td><td class="mdescRight">old signal mask <br /></td></tr>
<tr class="separator:a51124cf597f93f6f589e38f49464beb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9329373e072de2722816d1c2934405db" id="r_a9329373e072de2722816d1c2934405db"><td class="memItemLeft" align="right" valign="top"><a id="a9329373e072de2722816d1c2934405db" name="a9329373e072de2722816d1c2934405db"></a>
unsigned int&#160;</td><td class="memItemRight" valign="bottom"><b>mask</b></td></tr>
<tr class="memdesc:a9329373e072de2722816d1c2934405db"><td class="mdescLeft">&#160;</td><td class="mdescRight">signal mask <br /></td></tr>
<tr class="separator:a9329373e072de2722816d1c2934405db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff35389d9b4a1dcd31d5b4f5c03e349f" id="r_aff35389d9b4a1dcd31d5b4f5c03e349f"><td class="memItemLeft" align="right" valign="top"><a id="aff35389d9b4a1dcd31d5b4f5c03e349f" name="aff35389d9b4a1dcd31d5b4f5c03e349f"></a>
pid_t&#160;</td><td class="memItemRight" valign="bottom"><b>pid_scope</b></td></tr>
<tr class="memdesc:aff35389d9b4a1dcd31d5b4f5c03e349f"><td class="mdescLeft">&#160;</td><td class="mdescRight">process id of the process reading/writing the fpga <br /></td></tr>
<tr class="separator:aff35389d9b4a1dcd31d5b4f5c03e349f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29752742c115774f06e2f3a192395c62" id="r_a29752742c115774f06e2f3a192395c62"><td class="memItemLeft" align="right" valign="top"><a id="a29752742c115774f06e2f3a192395c62" name="a29752742c115774f06e2f3a192395c62"></a>
pid_t&#160;</td><td class="memItemRight" valign="bottom"><b>pid_socket</b></td></tr>
<tr class="memdesc:a29752742c115774f06e2f3a192395c62"><td class="mdescLeft">&#160;</td><td class="mdescRight">process id of the process reading/writing to the central DAQ <br /></td></tr>
<tr class="separator:a29752742c115774f06e2f3a192395c62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a832e9b64cbef8533a190e71ab02344fe" id="r_a832e9b64cbef8533a190e71ab02344fe"><td class="memItemLeft" align="right" valign="top"><a id="a832e9b64cbef8533a190e71ab02344fe" name="a832e9b64cbef8533a190e71ab02344fe"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>stop_process</b> =0</td></tr>
<tr class="memdesc:a832e9b64cbef8533a190e71ab02344fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">after an interrupt this flag is set so that all forked processes are killed <br /></td></tr>
<tr class="separator:a832e9b64cbef8533a190e71ab02344fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>steering file for the Detector Unit software </p>
<dl class="section author"><dt>Author</dt><dd>C. Timmermans, RU/Nikhef </dd></dl>
<dl class="section date"><dt>Date</dt><dd>30/12/2023 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a92f7b5d93622a416d05dcc46c41e7ab2" name="a92f7b5d93622a416d05dcc46c41e7ab2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92f7b5d93622a416d05dcc46c41e7ab2">&#9670;&#160;</a></span>block_signals()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void block_signals </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>iblock</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>block sigio/sigpipe </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>ok </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">iblock</td><td>When 1, block signals. Otherwise release block </td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>C. Timmermans </dd></dl>

</div>
</div>
<a id="a57d32a2cbac1da983a55bfb03a05c0fe" name="a57d32a2cbac1da983a55bfb03a05c0fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57d32a2cbac1da983a55bfb03a05c0fe">&#9670;&#160;</a></span>check_server_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int check_server_data </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>check and execute commands from central DAQ </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>Error </td></tr>
    <tr><td class="paramname">0</td><td>No new message </td></tr>
    <tr><td class="paramname">&gt;0</td><td>Length of message<ul>
<li>Checks if there is a message on the socket<ul>
<li>on error: shut down the connection</li>
</ul>
</li>
<li>read data until all is read or there is an error<ul>
<li>on error shut down socket connection</li>
</ul>
</li>
<li>interpret messages:<ul>
<li>DU_START/DU_STOP set run value to 1/0<ul>
<li>DU_INITIALIZE is stored in shared memory for interpretation by scope_check_commands()</li>
<li>DU_GETEVENT DU_GET_MINBIAS_EVENT DU_GET_RANDOM_EVENT moves event to the central DAQ</li>
<li>ALIVE responds with ACK_ALIVE to central DAQ</li>
</ul>
</li>
</ul>
</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>C. Timmermans </dd></dl>

</div>
</div>
<a id="a6307a963abd17f30664038b8f4499603" name="a6307a963abd17f30664038b8f4499603"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6307a963abd17f30664038b8f4499603">&#9670;&#160;</a></span>du_get_station_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void du_get_station_id </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Obtains station id from the ip address of the machine. The ip address can be obtained from the eth0 interface If the network address does not start with 10., the routine returns -1</p>
<dl class="section author"><dt>Author</dt><dd>C. Timmermans </dd></dl>

</div>
</div>
<a id="a40d5f8a6e595461f4a0a9c27ff598c0f" name="a40d5f8a6e595461f4a0a9c27ff598c0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40d5f8a6e595461f4a0a9c27ff598c0f">&#9670;&#160;</a></span>du_scope_check_commands()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void du_scope_check_commands </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>interpreting DAQ commands for fpga </p>
<ul>
<li>while there is a command in shared memory<ul>
<li>get the command tag<ul>
<li>on DU_BOOT, DU_RESET and DU_INITIALIZE<ul>
<li>creates file /Dudef.sh with all required devmem commands to initialize the fpga</li>
<li>sources this file</li>
<li>file is also used when booting the board</li>
</ul>
</li>
<li>no other commands are implemented here</li>
</ul>
</li>
<li>remove "to be executed" mark for this command</li>
<li>go to next command in shared memory</li>
</ul>
</li>
</ul>
<dl class="section author"><dt>Author</dt><dd>C. Timmermans </dd></dl>

</div>
</div>
<a id="ab8c0fdf47a45bfe19bbe33854fda9952" name="ab8c0fdf47a45bfe19bbe33854fda9952"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8c0fdf47a45bfe19bbe33854fda9952">&#9670;&#160;</a></span>du_scope_main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void du_scope_main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>main fpga handling routine </p>
<ul>
<li>continuous while loop<ul>
<li>when running:<ul>
<li>read data,</li>
<li>check if there has been a command from the DAQ</li>
</ul>
</li>
</ul>
</li>
</ul>
<dl class="section author"><dt>Author</dt><dd>C. Timmermans </dd></dl>

</div>
</div>
<a id="ad1fe02d124aabfd2ab6e4d54679248d8" name="ad1fe02d124aabfd2ab6e4d54679248d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1fe02d124aabfd2ab6e4d54679248d8">&#9670;&#160;</a></span>du_socket_main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void du_socket_main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles all communication with the IP socket. </p>
<ul>
<li>Opens a connection to the central DAQ<ul>
<li>In an infinite loop<ul>
<li>Every 0.2 seconds<ul>
<li>Check commands from the central DAQ</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>send T2-data to the central DAQ</p><ul>
<li>If there has not been contact for 13 seconds<ul>
<li>close and reopen the socket</li>
</ul>
</li>
</ul>
<dl class="section author"><dt>Author</dt><dd>C. Timmermans </dd></dl>

</div>
</div>
<a id="ae7193a4bd1cc84e09349989dfec2cb1d" name="ae7193a4bd1cc84e09349989dfec2cb1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7193a4bd1cc84e09349989dfec2cb1d">&#9670;&#160;</a></span>make_server_connection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int make_server_connection </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>port</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>connect to central DAQ </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>Error </td></tr>
    <tr><td class="paramname">0</td><td>ok </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">port</td><td>socket port id<ul>
<li>Create a socket</li>
<li>Bind this socket</li>
<li>Listen on this socket</li>
<li>Accept a connection on this socket</li>
<li>set default socket options </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>C. Timmermans </dd></dl>

</div>
</div>
<a id="a9a48765e628107301e3981a9370d2d56" name="a9a48765e628107301e3981a9370d2d56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a48765e628107301e3981a9370d2d56">&#9670;&#160;</a></span>send_server_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_server_data </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>send t2 data to the central DAQ </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>Error </td></tr>
    <tr><td class="paramname">0</td><td>No connection to DAQ </td></tr>
    <tr><td class="paramname">1</td><td>All ok<ul>
<li>If there is no connection to the central DAQ, try to connect</li>
<li>get T2 information from DDR and add to output buffer</li>
<li>send output buffer to the central DAQ</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>C. Timmermans </dd></dl>

</div>
</div>
<a id="ac6f7aeeb3effe54c0d30bb7ae34438ce" name="ac6f7aeeb3effe54c0d30bb7ae34438ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6f7aeeb3effe54c0d30bb7ae34438ce">&#9670;&#160;</a></span>socket_send()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int socket_send </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>bf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>send buffer to the central DAQ </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">number</td><td>of bytes sent try to send a buffer bf of size length over the socket to the central DAQ. Up to 100 tries are made</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>C. Timmermans </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
